openapi: 3.0.3
info:
  title: Instances Admin Documentation
  description: Admin Endpoint to manage playboard configurations for each customer.
  contact:
    email: play@empathy.co
  version: '1.0.0'
servers:
  - url: 'http://localhost:8080'
    description: local
  - url: 'https://play-api.kroger.internal.dataless.gcp.empathy.dev/'
    description: kroger dataless
  - url: 'https://play-api.carrefour.internal.dataless.gcp.empathy.dev/'
    description: carrefour dataless
security:
  - BearerAuth: []
paths:
  /admin/instances:
    get:
      tags:
        - Instances admin
      summary: Retrieve all instances admin configurations.
      operationId: getAllInstancesAdmin
      parameters:
        - name: rows
          in: query
          description: Number of items to be returned.
          required: false
          schema:
            type: integer
        - name: start
          in: query
          description: Number of items to skip before starting to collect the result.
          required: false
          schema:
            type: integer
        - name: sort.direction
          in: query
          description: Direction to sort results, ascendant or descendant.
          style: form
          schema:
            type: string
            enum:
              - ASC
              - DESC
        - name: sort.field
          in: query
          description: Sort the values by specific field.
          style: form
          schema:
            type: string
        - name: enabled
          in: query
          description: Filter by enabled/disabled state.
          required: false
          schema:
            type: boolean
        - name: instance
          in: query
          description: Id of the instance.
          required: false
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResultList_InstanceAdmin'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Unauthorized'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Forbidden'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'
    post:
      tags:
        - Instances admin
      summary: Create a new instance admin configuration.
      operationId: post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InstanceAdminBody'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceAdmin'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Unauthorized'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Forbidden'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'
  /admin/instances/{id}:
    get:
      tags:
        - Instances admin
      summary: Return an instance admin configuration for the given id.
      operationId: getById
      parameters:
        - name: id
          in: path
          description: Identifier of the instance admin configuration.
          required: true
          style: simple
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceAdmin'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequest'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Unauthorized'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Forbidden'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'
    put:
      tags:
        - Instances admin
      summary: Update an instance admin configuration for the given id.
      operationId: put
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InstanceAdminBody'
      parameters:
        - name: id
          in: path
          description: Identifier of the instance admin configuration.
          required: true
          style: simple
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceAdmin'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequest'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Unauthorized'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Forbidden'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'
    delete:
      tags:
        - Instances admin
      summary: Remove an instance admin configuration for the given id.
      operationId: delete
      parameters:
        - name: id
          in: path
          description: Identifier of the instance admin configuration.
          required: true
          style: simple
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceAdmin'
  /admin/instances/{id}/customization:
    get:
      tags:
        - Instances admin customization
      summary: Retrieve all customizations of the instances admin configurations id passed in by parameter.
      operationId: getAllInstancesAdminCustomization
      parameters:
        - name: id
          in: path
          description: Identifier of the instance admin configuratino.
          required: true
          style: simple
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceAdminCustomization'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Unauthorized'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Forbidden'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'
    put:
      tags:
        - Instances admin customization
      summary: Update a customization for the instance admin configuration id passed by parameter.
      operationId: putCustomization
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InstanceAdminCustomizationBody'
      parameters:
        - name: id
          in: path
          description: Identifier of the instance admin configuration.
          required: true
          style: simple
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceAdminCustomization'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequest'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Unauthorized'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Forbidden'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'
  /admin/instances/{id}/{domain}/permissions:
    get:
      tags:
        - Instaces admin permissions
      summary: Retrieve all permissions of the instances admin configurations id passed in by parameter.
      operationId: getPermissions
      parameters:
        - name: id
          in: path
          description: Identifier of the instance admin configuration.
          required: true
          style: simple
          schema:
            type: string
        - name: domain
          in: path
          description: Context in which permissions apply.
          required: true
          style: simple
          schema:
            type: string
            enum:
              - search
              - browse
              - global

      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceAdminPermissions'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Unauthorized'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Forbidden'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'
    put:
      tags:
        - Instaces admin permissions
      summary: Update permissions for the instance admin configuration id passed by parameter.
      operationId: putPermissions
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InstanceAdminPermissions'
      parameters:
        - name: id
          in: path
          description: Identifier of the instance admin configuration.
          required: true
          style: simple
          schema:
            type: string
        - name: domain
          in: path
          description: Context in which permissions apply
          required: true
          style: simple
          schema:
            type: string
            enum:
              - search
              - browse
              - global
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceAdminPermissions'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequest'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Unauthorized'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Forbidden'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'

  /admin/instances/{id}/{domain}/tools:
    get:
      tags:
        - Instaces admin tools
      summary: Retrieve tools for the instance admin passed by parameter.
      operationId: getTools
      parameters:
        - name: id
          in: path
          description: Identifier of the instance admin configuration.
          required: true
          style: simple
          schema:
            type: string
        - name: domain
          in: path
          description: Context in which permissions apply.
          required: true
          style: simple
          schema:
            type: string
            enum:
              - search
              - browse
              - global

      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceAdminTools'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Unauthorized'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Forbidden'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'
    put:
      tags:
        - Instaces admin tools
      summary: Update tools for the instance admin configuration id passed by parameter.
      operationId: putTools
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InstanceAdminTools'
      parameters:
        - name: id
          in: path
          description: Identifier of the instance admin configuration.
          required: true
          style: simple
          schema:
            type: string
        - name: domain
          in: path
          description: Context in which permissions apply
          required: true
          style: simple
          schema:
            type: string
            enum:
              - search
              - browse
              - global
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceAdminTools'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequest'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Unauthorized'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Forbidden'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'

components:
  schemas:
    InstanceAdmin:
      title: InstanceAdmin
      type: object
      properties:
        id:
          description: Generated unique id of the instance.
          type: string
        instance:
          description: Readable unique id of the instance, normally is the pretty_name without symbols, spaces and in lowercase.
          type: string
        enabled:
          description: Status of the instance.
          type: boolean
        metadata:
          $ref: '#/components/schemas/Metadata'

    ResultList_InstanceAdmin:
      title: ResultList«InstanceAdmin»
      type: object
      properties:
        num_found:
          description: Total number of instances.
          type: integer
        results:
          description: List of instances.
          type: array
          items:
            $ref: '#/components/schemas/InstanceAdmin'

    InstanceAdminBody:
      title: InstanceAdminBody
      description: Global configuration
      type: object
      properties:
        instance:
          description: Readable unique id of the instance, normally is the pretty_name without symbols, spaces and in lowercase.
          type: string
        enabled:
          description: Status of the instance.
          type: boolean

    LogoUrls:
      title: LogoUrls
      description: Different logos available for the instance
      type: object
      properties:
        imagotype:
          description: URL of an icon image and brand name.
          type: string
          format: URL
        isotype:
          description: URL of an icon image.
          type: string
          format: URL

    Metadata:
      title: Metadata
      description: Data of the configuration itself.
      type: object
      properties:
        created_on:
          description: When was created.
          type: string
          example: 'yyyy-MM-dd''T''HH:mm:ss''Z'''
        updated_on:
          description: When was updated the last time.
          type: string
          example: 'yyyy-MM-dd''T''HH:mm:ss''Z'''
        user:
          description: Who was the last one that modified it.
          type: string

    InstanceAdminCustomizationBody:
      title: CustomizationBody
      description: Customization of the instance admin configuration.
      type: object
      properties:
        logo_urls:
          $ref: '#/components/schemas/LogoUrls'

    InstanceAdminCustomization:
      title: Customization
      description: Customization of the instance admin configuration.
      type: object
      properties:
        logo_urls:
          $ref: '#/components/schemas/LogoUrls'
        metadata:
          $ref: '#/components/schemas/Metadata'

    InstanceAdminPermissions:
      title: Permissions
      description: Permissions of the instance admin.
      type: array
      items:
        type: object
        properties:
          id:
            description: Identifier of the permission.
            type: string
          level:
            description: Restriction on the permission.
            type: string
            enum:
              - NONE
              - PREVIEW
              - READ
              - WRITE

    InstanceAdminTools:
      title: Tools
      description: Specific configuration of each tool.
      type: object
      properties:
        base:
          $ref: '#/components/schemas/ToolConfig'
        configuration:
          $ref: '#/components/schemas/ConfigurationsToolConfig'
        synonym:
          $ref: '#/components/schemas/SynonymsToolConfig'
    SynonymsToolConfig:
      title: SynonymsToolConfig
      description: Configuration for the synonyms tool
      type: object
      properties:
        pivot_ids:
          type: array
          description: Values by which the catalog is segmented.
          items:
            type: string
        types:
          type: array
          description: List of the different synonym types used in the customer catalog.
          items:
            $ref: '#/components/schemas/SynonymTypeConfig'
    ToolConfig:
      title: ToolConfig
      description: Default configuration for all tools
      type: object
      properties:
        pivot_ids:
          type: array
          description: Values by which the catalog is segmented.
          items:
            type: string
    ConfigurationsToolConfig:
      title: ConfigurationsToolConfig
      description: Configuration for the "configurations" tool.
      type: object
      properties:
        attributes:
          type: array
          description: List that can be used to identify groups of products.
          items:
            type: object
            properties:
              id:
                type: string
                description: Product identifier.
              browse_id:
                type: string
                description: Browse identifier.
              facet_id:
                type: string
                description: Facet identifier.
              pretty_name:
                type: string
                description: Name of the product to be displayed
        pivot_ids:
          type: array
          description: Values by which the catalog is segmented.
          items:
            type: string
    SynonymTypeConfig:
      title: SynonymTypeConfig
      description: Configuration to define a synonym type.
      type: object
      properties:
        id:
          description: Identifier of the synonym type.
          type: string
        pretty_name:
          description: Pretty name for the synonyme type.
          type: string

    BadRequest:
      title: Bad Request
      type: object
      properties:
        timestamp:
          type: string
          example: "2021-03-31T12:41:28.293+00:00"
        status:
          type: integer
          example: 400
        error:
          type: string
          example: Bad Request
        details:
          type: object
          properties:
            id:
              type: string
            message:
              type: string
    Unauthorized:
      title: Unautorized
      type: object
      properties:
        timestamp:
          type: string
          example: "2021-03-31T12:41:28.293+00:00"
        status:
          type: integer
          example: 401
        error:
          type: string
          example: UNAUTHORIZED
        details:
          type: object
          properties:
            id:
              type: string
              example: UNAUTHORIZED
            message:
              type: string
              example: Full authentication is required to access this resource
    Forbidden:
      title: Forbidden
      type: object
      properties:
        timestamp:
          type: string
          example: "2021-03-31T12:41:28.293+00:00"
        status:
          type: integer
          example: 403
        error:
          type: string
          example: FORBIDDEN
        details:
          type: object
          properties:
            id:
              type: string
              example: FORBIDDEN
            message:
              type: string
              example: Access is denied
    InternalServerError:
      title: Internal Server Error
      type: object
      properties:
        timestamp:
          type: string
          example: "2021-03-31T12:41:28.293+00:00"
        status:
          type: integer
          example: 500
        error:
          type: string
          example: Internal Server Error
        details:
          type: object
          properties:
            id:
              type: string
            message:
              type: string


  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT